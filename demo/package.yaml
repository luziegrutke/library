id: demo
name: Demo Node Pipelines
author: Tenzir
author_icon: https://github.com/tenzir.png
package_icon: https://github.com/tenzir.png

description: |
  This package imports a pre-recorded data set from the M57-Patents company, a
  forensics research corpus generated by Woods at al. in 2001. The original
  packet captures were run through Suricata and Zeek, creating an example data
  set for Tenzir's demo nodes on app.tenzir.com.

pipelines:
  m57-suricata:
    name: M57 Suricata
    description: |
      Load Suricata Eve JSON logs from a GCS bucket and import them into the
      demo node.
    definition: |
      load https://storage.googleapis.com/tenzir-datasets/M57/suricata.json.zst
      | throttle 512Ki
      | decompress zstd
      | read suricata --no-infer
      | where #schema != "suricata.stats"
      | import

  m57-zeek:
    name: M57 Zeek
    description: |
      Load Zeek TSV logs from a GCS bucket and import them into the demo node.
    definition: |
      load https://storage.googleapis.com/tenzir-datasets/M57/zeek-all.log.zst
      | throttle 512Ki
      | decompress zstd
      | read zeek-tsv
      | import

snippets:
  - name: Show all Suricata alerts
    description: |
      Use the `where` operator to zero in on one particular schema.
    definition: |
      export
      | where #schema == "suricata.alert"

  - name: View a sample of Zeek TSV logs
    description: |
      The `taste` operator returns up to the specified number of events per
      schema. We use it to show some of all Zeek TSV logs to get an idea of our
      dataset.
    definition: |
      export
      | where "zeek" in #schema
      | taste 10

  - name: Identify long-running connections
    description: |
      Use the `where` operator with a more complex expression to identify
      long-running connections in a specific CIDR subnet.
    definition: |
      export
      | where #schema == "zeek.conn"
      | where :ip in 10.10.5.0/25
      | where orig_bytes > 1 Mi or duration > 30 min

  - name: Identify top hitters
    description: |
      Use the `top` operator to see the top 5 hitters in Zeek notice logs.
    definition: |
      export
      | where #schema == "zeek.notice"
      | top msg
      | head 5
